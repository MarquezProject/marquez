"use strict";(self.webpackChunkmarquez_website_docs=self.webpackChunkmarquez_website_docs||[]).push([[8853],{48584:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=t(87462),r=(t(67294),t(3905));const l={layout:"running-on-aws"},s="Running Marquez on AWS",o={unversionedId:"deployment/running-on-aws",id:"deployment/running-on-aws",title:"Running Marquez on AWS",description:"This guide helps you deploy and manage Marquez on AWS EKS.",source:"@site/docs/deployment/running-on-aws.mdx",sourceDirName:"deployment",slug:"/deployment/running-on-aws",permalink:"/docs/deployment/running-on-aws",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deployment/running-on-aws.mdx",tags:[],version:"current",frontMatter:{layout:"running-on-aws"},sidebar:"tutorialSidebar",previous:{title:"Deployment Overview",permalink:"/docs/deployment/"},next:{title:"Frequently Asked Questions",permalink:"/docs/faq"}},i={},p=[{value:"PREREQUISITES",id:"prerequisites",level:4},{value:"AWS EKS Cluster",id:"aws-eks-cluster",level:2},{value:"CONNECT TO AWS EKS CLUSTER",id:"connect-to-aws-eks-cluster",level:5},{value:"AWS RDS",id:"aws-rds",level:2},{value:"CREATE AWS RDS DATABASE",id:"create-aws-rds-database",level:5},{value:"CONNECT TO AWS RDS DATABASE",id:"connect-to-aws-rds-database",level:5},{value:"Deploy Marquez on AWS EKS",id:"deploy-marquez-on-aws-eks",level:2},{value:"INSTALLING MARQUEZ",id:"installing-marquez",level:5},{value:"UNINSTALLING MARQUEZ",id:"uninstalling-marquez",level:5}],m={toc:p},u="wrapper";function c(e){let{components:a,...t}=e;return(0,r.kt)(u,(0,n.Z)({},m,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"running-marquez-on-aws"},"Running Marquez on AWS"),(0,r.kt)("p",null,"This guide helps you deploy and manage Marquez on AWS ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/eks"},"EKS"),"."),(0,r.kt)("h4",{id:"prerequisites"},"PREREQUISITES"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html"},"AWS CLI")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://helm.sh/docs/helm/helm_install/"},"helm")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/"},"kubectl"))),(0,r.kt)("h2",{id:"aws-eks-cluster"},"AWS EKS Cluster"),(0,r.kt)("p",null,"To create an AWS EKS cluster, please follow the steps outlined in the AWS EKS ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/eks/latest/userguide/create-cluster.html"},"documentation"),"."),(0,r.kt)("h5",{id:"connect-to-aws-eks-cluster"},"CONNECT TO AWS EKS CLUSTER"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Make sure you have configured your ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html"},"AWS CLI"),", then create or update the ",(0,r.kt)("strong",{parentName:"p"},"kubeconfig")," file for your cluster:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ aws eks --region <AWS-REGION> update-kubeconfig --name <AWS-EKS-CLUSTER>\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify that the context has been switched:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl config current-context\narn:aws:eks:<AWS-REGION>:<AWS-ACCOUNT-ID>:cluster/<AWS-EKS-CLUSTER>\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Using ",(0,r.kt)("inlineCode",{parentName:"p"},"kubectl"),", verify that you can connect to your cluster:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get svc\nNAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nsvc/kubernetes   ClusterIP   10.100.0.1   <none>        443/TCP   1m\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note"),": If you're having issues connecting to your cluster, please see ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/premiumsupport/knowledge-center/eks-cluster-connection"},"Why can't I connect to my AWS EKS cluster?"))))),(0,r.kt)("h2",{id:"aws-rds"},"AWS RDS"),(0,r.kt)("p",null,"Next, create an AWS RDS instance as outlined in the AWS RDS ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_CreateDBInstance.html"},"documentation"),". This database will be used to store dataset, job, and run metadata collected as ",(0,r.kt)("a",{parentName:"p",href:"https://openlineage.io"},"OpenLineage")," events via the Marquez ",(0,r.kt)("a",{parentName:"p",href:"https://marquezproject.github.io/marquez/openapi.html"},"HTTP API"),"."),(0,r.kt)("h5",{id:"create-aws-rds-database"},"CREATE AWS RDS DATABASE"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to the AWS ",(0,r.kt)("a",{parentName:"li",href:"https://console.aws.amazon.com/rds/home"},"RDS")," page and create a PostgreSQL database, leaving the database template as ",(0,r.kt)("strong",{parentName:"li"},"Production"),"."),(0,r.kt)("li",{parentName:"ol"},"Use ",(0,r.kt)("inlineCode",{parentName:"li"},"marquez")," as the database identifier and set the master username to ",(0,r.kt)("inlineCode",{parentName:"li"},"marquez"),"."),(0,r.kt)("li",{parentName:"ol"},"Choose a master password to use later in your Helm deployment (see ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/MarquezProject/marquez/blob/main/chart/values.yaml#L32"},"password"),"  in ",(0,r.kt)("inlineCode",{parentName:"li"},"values.yaml"),")."),(0,r.kt)("li",{parentName:"ol"},"Leave public access to the database ",(0,r.kt)("strong",{parentName:"li"},"off"),"."),(0,r.kt)("li",{parentName:"ol"},"Choose the same VPC where your AWS EKS cluster resides."),(0,r.kt)("li",{parentName:"ol"},"In a separate tab, navigate to the AWS EKS cluster page and make note of the security group attached to your cluster."),(0,r.kt)("li",{parentName:"ol"},"Navigate back to the AWS RDS page and, in the security group section, add the AWS EKS cluster\u2019s security group from ",(0,r.kt)("strong",{parentName:"li"},"step 6"),"."),(0,r.kt)("li",{parentName:"ol"},"Next, under the ",(0,r.kt)("strong",{parentName:"li"},"Additional Configuration")," tab, enter ",(0,r.kt)("inlineCode",{parentName:"li"},"marquez")," as the initial database name."),(0,r.kt)("li",{parentName:"ol"},"Finally, select ",(0,r.kt)("strong",{parentName:"li"},"Create Database"),".")),(0,r.kt)("h5",{id:"connect-to-aws-rds-database"},"CONNECT TO AWS RDS DATABASE"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"marquez")," namespace:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl create namespace marquez\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Next, run the following command with your AWS RDS ",(0,r.kt)("inlineCode",{parentName:"p"},"host"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"username"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"password"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl run pgsql-postgresql-client --rm --tty -i --restart='Never' \\\n  --namespace marquez \\\n  --image docker.io/bitnami/postgresql:12-debian-10 \\\n  --env=\"PGPASSWORD=<AWS-RDS-PASSWORD>\" \\\n  --command -- psql marquez --host <AWS-RDS-HOST> -U <AWS-RDS-USERNAME> -d marquez -p 5432\n")))),(0,r.kt)("h2",{id:"deploy-marquez-on-aws-eks"},"Deploy Marquez on AWS EKS"),(0,r.kt)("h5",{id:"installing-marquez"},"INSTALLING MARQUEZ"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Get Marquez:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone git@github.com:MarquezProject/marquez.git && cd chart\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install Marquez:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm upgrade --install marquez .\n  --set marquez.db.host=<AWS-RDS-HOST>\n  --set marquez.db.user=<AWS-RDS-USERNAME>\n  --set marquez.db.password=<AWS-RDS-PASSWORD>\n  --namespace marquez\n  --atomic\n  --wait\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Note:")," To avoid overriding deployment settings via the command line, update the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/blob/main/chart/values.yaml#L27"},"marquez.db")," section of the Marquez Helm chart's ",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml")," to include the AWS RDS ",(0,r.kt)("inlineCode",{parentName:"p"},"host"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"username"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"password")," in your deployment."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify all the pods have come up correctly:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get pods --namespace marquez\n")))),(0,r.kt)("h5",{id:"uninstalling-marquez"},"UNINSTALLING MARQUEZ"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"helm uninstall marquez --namespace marquez\n")))}c.isMDXComponent=!0}}]);