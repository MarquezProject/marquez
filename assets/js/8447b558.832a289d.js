"use strict";(self.webpackChunkmarquez_website_docs=self.webpackChunkmarquez_website_docs||[]).push([[4204],{13111:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const i={slug:"version-30-upgrades",description:"How to ensure a smooth transition to the latest version of Marquez.",title:"Marquez 0.30.0 offers a big performance bump, with some assembly required",authors:{name:"Michael Robinson",title:"Marquez Community Manager",url:"https://github.com/merobi-hub",image_url:"https://github.com/merobi-hub.png"},tags:["releases","web"]},o=void 0,s={permalink:"/blog/version-30-upgrades",editUrl:"https://github.com/MarquezProject/marquez/tree/docs/v2/docs-v2/blog/2023-02-03-version-30-upgrades.mdx",source:"@site/blog/2023-02-03-version-30-upgrades.mdx",title:"Marquez 0.30.0 offers a big performance bump, with some assembly required",description:"How to ensure a smooth transition to the latest version of Marquez.",date:"2023-02-03T00:00:00.000Z",formattedDate:"February 3, 2023",tags:[{label:"releases",permalink:"/blog/tags/releases"},{label:"web",permalink:"/blog/tags/web"}],readingTime:2.5,hasTruncateMarker:!0,authors:[{name:"Michael Robinson",title:"Marquez Community Manager",url:"https://github.com/merobi-hub",image_url:"https://github.com/merobi-hub.png",imageURL:"https://github.com/merobi-hub.png"}],frontMatter:{slug:"version-30-upgrades",description:"How to ensure a smooth transition to the latest version of Marquez.",title:"Marquez 0.30.0 offers a big performance bump, with some assembly required",authors:{name:"Michael Robinson",title:"Marquez Community Manager",url:"https://github.com/merobi-hub",image_url:"https://github.com/merobi-hub.png",imageURL:"https://github.com/merobi-hub.png"},tags:["releases","web"]},prevItem:{title:"The February Marquez Community Meeting Focused on UI Upgrades and Recent Releases",permalink:"/blog/2-23-meeting"},nextItem:{title:"Trying Out the New Column Lineage Feature",permalink:"/blog/column-lineage-demo"}},u={authorsImageUrls:[void 0]},l=[{value:"Marquez 0.30.0",id:"marquez-0300",level:2},{value:"Migration Procedure",id:"migration-procedure",level:2},{value:"More Information",id:"more-information",level:2}],m={toc:l},p="wrapper";function h(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This is a guide to making a smooth transition to the latest version of Marquez."),(0,r.kt)("h2",{id:"marquez-0300"},"Marquez 0.30.0"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/releases/tag/0.30.0"},"Marquez 0.30.0"),",\nwhich we released on 2023-01-31, contains some exciting new features, including\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/pull/2293"},"column-level lineage")," and\na ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/pull/2343"},"soft delete option")," in\nthe UI."),(0,r.kt)("p",null,"Along with these long-awaited UI upgrades come some significant performance\nimprovements to the API. In prior versions of Marquez, accessing OpenLineage\nfacets required direct queries against the OpenLineage events table, which could\nbe quite costly depending on the size of this table. Some users have events\ntables with more than 100K rows -- millions of rows, in fact. To address this\nperformance issue, Marquez 0.30.0 has new tables for dataset, job and run facets."),(0,r.kt)("p",null,"So far, so simple, right? Protecting against data loss and ensuring a smooth\nexperience for users was not so simple, in fact. We needed a way to migrate the\ndata while not only avoiding loss but also keeping downtime to a minimum. The\nsolution that ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/wslulciuc"},"Willy")," and\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pawel-big-lebowski"},"Pawel")," found (with input from\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/collado-mike"},"Mike Collado"),") was to keep the data in the\nevents table until the migration process is complete and to create views on top\nof the table for accessing the facets. After migration is complete, the views\nare replaced to point to the new tables. Using views provides safeguards and\nminimizes downtime during the migration. "),(0,r.kt)("h2",{id:"migration-procedure"},"Migration Procedure"),(0,r.kt)("p",null,"As the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/blob/main/api/src/main/resources/marquez/db/migration/V57__readme.md"},"migration plan"),"\nsays, users whose ",(0,r.kt)("inlineCode",{parentName:"p"},"lineage_events")," tables have up to 100K rows can set it and\nforget it -- no extra work is required beyond upgrading and restarting\nMarquez, but be prepared for a brief downtime while a standard Flyway migration\nfills the newly created tables automatically."),(0,r.kt)("p",null,"For heavy users whose ",(0,r.kt)("inlineCode",{parentName:"p"},"lineage_events")," tables have more than 100K rows, a\ndifferent process will be used. Instead of a standard migration, the process will\nhappen asynchronously so that the user can start the API and consume new\nOpenLineage events as usual. Note that some API calls might return results\nslowly during the migration, especially if the output is based on facets."),(0,r.kt)("p",null,"To perform a migration, these users must run a new ",(0,r.kt)("inlineCode",{parentName:"p"},"db-migrate")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"java -jar api/build/libs/marquez-api-0.30.0.jar db-migrate --version v57 ./marquez.yml\n")),(0,r.kt)("p",null,"Available command arguments, ",(0,r.kt)("inlineCode",{parentName:"p"},"version")," (required) and ",(0,r.kt)("inlineCode",{parentName:"p"},"chunkSize")," (optional),\nallow the user to specify the migration version to apply and the number of\nlineage events to process (the default being 10,000). The command will process\nthe data not in its entirety but in chunks, storing a state with information\nabout the chunks being processed. Consequently,"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"it can be stopped any time"),(0,r.kt)("li",{parentName:"ul"},"it will continue automatically and process the remaining chunks. ")),(0,r.kt)("p",null,"A sample command specifying version 57 and 50,000 events:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"java -jar api/build/libs/marquez-api-0.30.0.jar db-migrate --version v57 --chunkSize 50000 ./marquez.yml\n")),(0,r.kt)("h2",{id:"more-information"},"More Information"),(0,r.kt)("p",null,"For more details about what, if anything, you will need to do to ensure a smooth\ntransition to Marquez 0.30.0, check out the helpful\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/blob/main/api/src/main/resources/marquez/db/migration/V57__readme.md"},"migration plan"),"\nput together by ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/wslulciuc"},"Willy")," and\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pawel-big-lebowski"},"Pawel"),". "),(0,r.kt)("p",null,"For more information about the improvements and additions in Marquez 0.30.0, check\nout ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MarquezProject/marquez/releases/tag/0.30.0"},"the release on GitHub"),"."))}h.isMDXComponent=!0}}]);