# Dockerfile for OAuth2 Proxy
FROM quay.io/oauth2-proxy/oauth2-proxy:v7.2.0

# Optionally, set environment variables directly
ENV OAUTH2_PROXY_COOKIE_SECRET=q1tnPgRxACH6eKasGBBrkpdlou9Blj0a_HHmX52__CM=
ENV OAUTH2_PROXY_PROVIDER=oidc
ENV OAUTH2_PROXY_SCOPE="openid profile email groups"
ENV OAUTH2_PROXY_PROVIDER_DISPLAY_NAME=Okta
ENV OAUTH2_PROXY_SKIP_PROVIDER_BUTTON=true
ENV OAUTH2_PROXY_CLIENT_ID=0oa1zfdpg80bKlXcq0h8
ENV OAUTH2_PROXY_CLIENT_SECRET=dwqew26OdAfXMaEfRHEVnVP05SmXbfwdtkOeOtSBQ6Z-vpyexeKV9MnsTgLDY8Bo
ENV OAUTH2_PROXY_REDIRECT_URL=https://localhost/oauth2/callback
ENV OAUTH2_PROXY_OIDC_ISSUER_URL=https://nubank.okta.com
ENV OAUTH2_PROXY_UPSTREAMS=http://marquez-web:3000
ENV OAUTH2_PROXY_HTTP_ADDRESS=0.0.0.0:4180
ENV OAUTH2_PROXY_EMAIL_DOMAINS=*
ENV OAUTH2_PROXY_COOKIE_SECURE=true
ENV OAUTH2_PROXY_COOKIE_HTTPONLY=true
ENV OAUTH2_PROXY_COOKIE_SAMESITE=lax
ENV OAUTH2_PROXY_PASS_USER_HEADERS=true
ENV OAUTH2_PROXY_LOG_LEVEL=debug
ENV OAUTH2_PROXY_REVERSE_PROXY=true
ENV OAUTH2_PROXY_COOKIE_NAME=SESSION
ENV OAUTH2_PROXY_COOKIE_REFRESH=60m
ENV OAUTH2_PROXY_COOKIE_EXPIRE=12h
ENV OAUTH2_PROXY_SKIP_AUTH_REGEX=^/favicon\.ico$

# Expose the port
EXPOSE 4180

# Start OAuth2 Proxy
CMD ["oauth2-proxy"]