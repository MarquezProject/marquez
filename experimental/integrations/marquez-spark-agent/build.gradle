/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.6.1/userguide/java_library_plugin.html
 */

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
    id 'com.github.johnrengelman.shadow' version '6.0.0'
    id 'com.diffplug.spotless' version '5.1.0'
    id 'com.adarshr.test-logger' version '2.1.1'
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}


repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenLocal()
}

dependencies {
    implementation 'org.javassist:javassist:3.20.0-GA'
    compileOnly 'org.apache.spark:spark-core_2.11:2.4.7'
    compileOnly 'org.apache.spark:spark-sql_2.11:2.4.7'
    implementation 'com.github.ok2c.hc5:hc5-async-json:0.2.1'
    compileOnly 'org.projectlombok:lombok:1.18.16'
    implementation 'org.apache.httpcomponents.client5:httpclient5:5.0.3'

    implementation 'com.fasterxml.jackson.core:jackson-databind:2.12.0'
    implementation 'com.fasterxml.jackson.core:jackson-core:2.12.0'
    implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.12.0'
    testImplementation 'net.bytebuddy:byte-buddy-agent:1.10.19'
    testImplementation 'net.bytebuddy:byte-buddy-dep:1.10.19'
    testImplementation 'org.apache.spark:spark-core_2.11:2.4.7'
    testImplementation 'org.apache.spark:spark-sql_2.11:2.4.7'
    testImplementation 'org.mockito:mockito-core:3.6.28'
    testImplementation 'junit:junit:4.13'

    annotationProcessor "org.projectlombok:lombok:1.18.16"
}

shadowJar {
    // avoid conflict with any client version of that lib
    relocate 'com.github.ok2c.hc5', 'marquez.com.github.ok2c.hc5'
    relocate 'org.apache.httpcomponents.client5', 'marquez.org.apache.httpcomponents.client5'
    relocate 'javassist', 'marquez.javassist'
    relocate 'javassist', 'marquez.javassist'
    relocate 'com.fasterxml.jackson', 'marquez.com.fasterxml.jackson'
    zip64 true
}

spotless {
    java {
        googleJavaFormat()
        removeUnusedImports()
    }
}

jar {
    manifest {
        attributes(
                "Premain-Class": "marquez.spark.agent.MarquezAgent",
                "Agent-Class": "marquez.spark.agent.MarquezAgent"
        )
    }
}